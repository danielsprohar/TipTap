<ng-container *ngIf="lesson$ | async as lesson; else loading">
  <div class="container centered">
    <ng-container *ngIf="!lesson.book; else advanced">
      <h2>{{ lesson.hand }} | {{ lesson.finger }}</h2>
    </ng-container>
    <ng-template #advanced>
      <h2>{{ lesson.book?.title! | dehyphenate | titlecase }}</h2>
      <h3>{{ lesson.book?.chapter }}</h3>
    </ng-template>
  </div>

  <section class="container">
    <table>
      <thead>
        <th>Time Remaining</th>
        <th>Errors</th>
        <th>Total Characters</th>
        <th>Total Words</th>
        <th>Words / Minute</th>
      </thead>
      <tbody>
        <tr>
          <td *ngIf="inProgress && (timer$ | async) as timer; else default">
            {{ session.duration - timer }}
          </td>
          <ng-template #default>
            <td>{{ session.duration }}</td>
          </ng-template>

          <ng-container
            *ngIf="metrica$ | async as metrica; else defaultMetrica"
          >
            <td>{{ metrica.errorCount }}</td>
            <td>{{ metrica.characterCount }}</td>
            <td>{{ metrica.wordCount }}</td>
            <td>{{ metrica.wpm }}</td>
          </ng-container>
          <ng-template #defaultMetrica>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
          </ng-template>
        </tr>
      </tbody>
    </table>
  </section>

  <app-terminal [lesson]="lesson"></app-terminal>
  <app-keyboard></app-keyboard>
  <app-results-dialog></app-results-dialog>
</ng-container>

<ng-template #loading>
  <div class="container">
    <article aria-busy="true"></article>
  </div>
</ng-template>
